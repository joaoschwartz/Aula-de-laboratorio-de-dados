---
title: "Endrews Soares, Giulio Maiolino,Jo√£o Victor Schwartz e Joel Fernando Maciel Apparicio"
format: html
editor: visual
---

```{r}
#| label: load-packages
#| include: false
library(WDI)
library(tidyverse)
library(sf)
library(rnaturalearth)
library(leaflet)
library(plotly)
library(countrycode)
library(WDI)
library(ggplot2)
library(gganimate)
library(dplyr)
library(rnaturalearth)
library(rnaturalearthdata)
library(sf)
library(countrycode)
library(gifski)
library(tidyr)
library(scales)
dadosexp <- WDI(country = "all",
                indicator = "NE.EXP.GNFS.ZS",
                start = 2000,
                end = 2022,
                extra = TRUE)

# 2. Limpeza: filtrar apenas pa√≠ses reais e criar c√≥digo ISO3
dadosexp <- dadosexp %>%
  filter(region != "Aggregates") %>%
  mutate(iso3c = countrycode(iso2c, origin = "iso2c", destination = "iso3c")) %>%
  filter(!is.na(iso3c))

# 3. Criar grade completa com todos os pa√≠ses e anos
anos <- 2000:2022
paises <- unique(dadosexp$iso3c)
grade <- expand.grid(iso3c = paises, year = anos)

# 4. Unir grade com dados reais
dadosexp_completo <- left_join(grade, dadosexp, by = c("iso3c", "year"))

# 5. Criar faixas de exporta√ß√µes (% do PIB)
dadosexp_completo <- dadosexp_completo %>%
  mutate(faixa_export = case_when(
    is.na(NE.EXP.GNFS.ZS) ~ "Sem dado",
    NE.EXP.GNFS.ZS <= 20 ~ "0‚Äì20%",
    NE.EXP.GNFS.ZS <= 40 ~ "21‚Äì40%",
    NE.EXP.GNFS.ZS <= 60 ~ "41‚Äì60%",
    NE.EXP.GNFS.ZS <= 80 ~ "61‚Äì80%",
    NE.EXP.GNFS.ZS <= 100 ~ "81‚Äì100%",
    NE.EXP.GNFS.ZS > 100 ~ "+100%"
  ))

# 6. Definir ordem das faixas na legenda
dadosexp_completo$faixa_export <- factor(
  dadosexp_completo$faixa_export,
  levels = c("0‚Äì20%", "21‚Äì40%", "41‚Äì60%", "61‚Äì80%", "81‚Äì100%", "+100%", "Sem dado")
)

# 7. Carregar mapa base
world <- ne_countries(scale = "medium", returnclass = "sf")

# 8. Juntar geometria com dados
map_data <- left_join(world, dadosexp_completo, by = c("iso_a3" = "iso3c"))

# 9. Definir cores para cada faixa
cores_personalizadas <- c(
  "0‚Äì20%" = "#ffffcc",
  "21‚Äì40%" = "#a1dab4",
  "41‚Äì60%" = "#41b6c4",
  "61‚Äì80%" = "#2c7fb8",
  "81‚Äì100%" = "#253494",
  "+100%" = "#081d58",
  "Sem dado" = "gray90"
)

dados <- WDI(
  country = "all",
  indicator = c("NE.EXP.GNFS.ZS", "NY.GDP.MKTP.KD.ZG"),
  start = 2020,
  end = 2020,
  extra = TRUE
)

# 2. Limpeza: filtrar apenas pa√≠ses reais e criar c√≥digo ISO3
dados <- dados %>%
  filter(region != "Aggregates") %>%
  mutate(iso3c = countrycode::countrycode(iso2c, origin = "iso2c", destination = "iso3c")) %>%
  filter(!is.na(iso3c))

# 3. Criar faixas de exporta√ß√µes (% do PIB)
dados <- dados %>%
  mutate(faixa_export = case_when(
    is.na(NE.EXP.GNFS.ZS) ~ "Sem dado",
    NE.EXP.GNFS.ZS <= 20 ~ "0‚Äì20%",
    NE.EXP.GNFS.ZS <= 40 ~ "21‚Äì40%",
    NE.EXP.GNFS.ZS <= 60 ~ "41‚Äì60%",
    NE.EXP.GNFS.ZS <= 80 ~ "61‚Äì80%",
    NE.EXP.GNFS.ZS <= 100 ~ "81‚Äì100%",
    NE.EXP.GNFS.ZS > 100 ~ "+100%"
  )) %>%
  mutate(faixa_export = factor(
    faixa_export,
    levels = c("0‚Äì20%", "21‚Äì40%", "41‚Äì60%", "61‚Äì80%", "81‚Äì100%", "+100%", "Sem dado")
  ))

# 4. Carregar mapa base
world <- ne_countries(scale = "medium", returnclass = "sf")

# 5. Juntar geometria com dados
map_data_la <- left_join(world, dados, by = c("iso_a3" = "iso3c"))

# 6. Definir paleta de cores para as faixas de exporta√ß√µes
cores_personalizadas <- c(
  "0‚Äì20%" = "#ffffcc",
  "21‚Äì40%" = "#a1dab4",
  "41‚Äì60%" = "#41b6c4",
  "61‚Äì80%" = "#2c7fb8",
  "81‚Äì100%" = "#253494",
  "+100%" = "#081d58",
  "Sem dado" = "gray90"
)

# 7. Criar paleta para o leaflet
pal <- colorFactor(
  palette = cores_personalizadas,
  domain = map_data$faixa_export
)
dadoslpo <- WDI(
  country = "all",
  indicator = "FI.RES.TOTL.CD",
  start = 2000,
  end = 2023,
  extra = TRUE
)

# 2. Limpar dados
dados_limpos <- dadoslpo %>%
  filter(region != "Aggregates") %>%
  select(iso3c, country, year, reservas = FI.RES.TOTL.CD)

# 3. Carregar mapa base (sf)
mapa_base <- ne_countries(scale = "medium", returnclass = "sf") %>%
  select(iso_a3, geometry)

# 4. Juntar dados com mapa base
mapa_dados <- dados_limpos %>%
  inner_join(mapa_base, by = c("iso3c" = "iso_a3")) %>%
  st_as_sf()  # garante que √© sf

# 5. Calcular log (para escala)
mapa_dados <- mapa_dados %>%
  mutate(log_reservas = log10(reservas + 1))
```

# **An√°lise de Choques Externos sob a Perspectiva** **do Crescimento por Exporta√ß√µes**

**Introdu√ß√£o**

A globaliza√ß√£o produtiva e comercial das √∫ltimas d√©cadas intensificou os la√ßos econ√¥micos entre
na√ß√µes, elevando o peso das exporta√ß√µes nas estrat√©gias de crescimento de muitos pa√≠ses, sobretudo
nos emergentes. Sob essa din√¢mica, surge uma quest√£o central para a an√°lise macroecon√¥mica
internacional:

**"Crescimentos baseados em exporta√ß√µes tornam os pa√≠ses mais vulner√°veis a
choques externos do que crescimentos baseados em demanda interna?"**

Pa√≠ses orientados para o exterior se beneficiam da inser√ß√£o nas cadeias globais de valor, acesso a
mercados mais amplos e ganhos de produtividade via especializa√ß√£o. No entanto, essa mesma
exposi√ß√£o os torna suscet√≠veis a instabilidades globais, como crises financeiras, recess√µes em pa√≠ses
parceiros ou disrup√ß√µes log√≠sticas. Em contrapartida, modelos baseados na demanda interna oferecem
maior capacidade de amortecimento frente a choques externos, mas exigem um mercado interno
robusto e pol√≠ticas p√∫blicas consistentes.
Este relat√≥rio analisa essa quest√£o utilizando dados do Banco Mundial (WDI), com foco em indicadores
chave como exporta√ß√µes de bens e servi√ßos (% do PIB), reservas internacionais, termos de troca e
varia√ß√µes do PIB real per capita durante as crises globais de 2008 e 2020. A abordagem combina s√©ries
temporais globais, visualiza√ß√µes espaciais e correla√ß√µes entre vulnerabilidade externa e integra√ß√£o
comercial.

#  Exporta√ß√µes de Bens e Servi√ßos (% do PIB)

O gr√°fico abaixo apresenta a m√©dia mundial do indicador NE.EXP.GNFS.ZS (exporta√ß√µes como % do PIB) ao longo dos √∫ltimos 30 anos. Observa-se um crescimento constante at√© 2008, quando ocorreu a crise financeira global, seguido de queda abrupta, recupera√ß√£o parcial na d√©cada seguinte e nova queda em 2020 com a pandemia da COVID-19.
An√°lise: - Pa√≠ses com mais de 40% do PIB vinculado a exporta√ß√µes s√£o estruturalmente mais sens√≠veis a
flutua√ß√µes da demanda global. A interdepend√™ncia comercial leva √† transmiss√£o quase imediata de
choques de grandes economias (como EUA ou China) para seus parceiros comerciais. Economias com
maior propor√ß√£o de consumo e investimento interno no PIB tendem a amortecer os impactos externos
e manter maior estabilidade. A composi√ß√£o das exporta√ß√µes tamb√©m importa: exporta√ß√µes baseadas
em commodities exp√µem os pa√≠ses √† volatilidade dos pre√ßos internacionais.

```{r}
#| label: graficodadosempainel
#| warning: false
#| echo: false

ggplot(map_data) +
  geom_sf(aes(fill = faixa_export, group = iso_a3), color = "gray80", size = 0.1) +
  scale_fill_manual(
    values = cores_personalizadas,
    name = "Exporta√ß√µes (% do PIB)"
  ) +
  theme_minimal() +
  labs(
    title = "Exporta√ß√µes de Bens e Servi√ßos (% do PIB)",
    subtitle = "Ano: {frame_time}",
    caption = "Fonte: World Development Indicators (WDI)"
  ) +
  transition_time(year) +
  ease_aes("linear") +
  theme(
    legend.position = "bottom",
    legend.title = element_text(size = 11, face = "bold"),
    legend.text = element_text(size = 9),
    plot.title = element_text(size = 18, face = "bold"),
    plot.subtitle = element_text(size = 14),
    plot.caption = element_text(size = 9)
  )
```

#  Impacto no PIB Real Per Capita: Choque de 2020

A partir dos dados NY.GDP.PCAP.KD , calculou-se a varia√ß√£o percentual do PIB real per capita durante
o ano de crise. O mapa abaixo mostram a intensidade da queda por pa√≠s:
2020: Crise sanit√°ria global com impacto mais sim√©trico, afetando a mobilidade, turismo,
servi√ßos e cadeias de suprimentos. A queda do PIB foi generalizada, mas a intensidade variou
com base na estrutura econ√¥mica e na capacidade de resposta dos governos. Padr√µes observados nos mapas: Economias asi√°ticas com foco interno e pol√≠ticas industriais, como √çndia e Indon√©sia, apresentaram resili√™ncia comparativa. Economias muito abertas e com depend√™ncia de turismo (como Tail√¢ndia, Espanha, Maldivas) sofreram quedas severas. Pa√≠ses da Am√©rica Latina e √Åfrica, com baixa diversifica√ß√£o e exporta√ß√£o de commodities, enfrentaram crises prolongadas. Al√©m disso, pa√≠ses com menor capacidade fiscal e sanit√°ria tiveram dificuldade de implementar est√≠mulos e conten√ß√µes adequadas, exacerbando a retra√ß√£o econ√¥mica.

```{r}
#| label: grafico2
#| warning: false
#| echo: false

leaflet(data = map_data_la) %>%
  addTiles() %>%
  addPolygons(
    fillColor = ~pal(faixa_export),
    fillOpacity = 0.7,
    color = "gray80",
    weight = 1,
    popup = ~paste(
      "<b>", name, "</b><br>",
      "Exporta√ß√µes (% do PIB): ", round(NE.EXP.GNFS.ZS, 1), "%<br>",
      "Crescimento do PIB (%): ", round(NY.GDP.MKTP.KD.ZG, 1), "%"
    )
  ) %>%
  addLegend(
    position = "bottomright",
    pal = pal,
    values = ~faixa_export,
    title = "Exporta√ß√µes (% do PIB) em 2020",
    opacity = 0.7
  ) %>%
  setView(lng = 0, lat = 20, zoom = 2)
```

#  Reservas Cambiais e Termos de Troca

**As reservas internacionais** (FI.RES.TOTL.CD) funcionam como um "colch√£o" de seguran√ßa para
enfrentar crises externas, permitindo que os governos intervenham no c√¢mbio, cumpram obriga√ß√µes
internacionais e reduzam o risco-pa√≠s. J√° os termos de troca (NE.TRM.TRAD.XD) refletem o poder de
compra das exporta√ß√µes em rela√ß√£o √†s importa√ß√µes, funcionando como um term√¥metro do equil√≠brio
estrutural do com√©rcio externo.
**Durante os choques de 2008 e 2020:** - Pa√≠ses com altas reservas cambiais (como China, Su√≠√ßa e Jap√£o)
conseguiram estabilizar suas moedas, manter credibilidade e adotar pol√≠ticas antic√≠clicas. - Na√ß√µes com
reservas baixas, como diversos pa√≠ses africanos e latino-americanos, enfrentaram crises cambiais e
quedas bruscas nas importa√ß√µes essenciais. - Os termos de troca pioraram especialmente para pa√≠ses
exportadores de mat√©rias-primas, que viram seus produtos se desvalorizar enquanto os pre√ßos de bens
manufaturados e insumos importados se mantiveram elevados.
Em resumo, as reservas funcionam como linha de defesa de curto prazo, enquanto os termos de troca
indicam vulnerabilidade estrutural. Ambos s√£o fundamentais para entender a resili√™ncia ou fragilidade
diante de choques externos.

```{r}
#| label: grafico3
#| warning: false
#| echo: false
#| 
ggplot(mapa_dados) +
  geom_sf(aes(fill = log_reservas), color = "#2c2c2c", size = 0.1) +
  scale_fill_viridis_c(
    name = "Reservas Internacionais (USD correntes)",
    option = "magma",
    direction = -1,
    na.value = "#f0f0f0",
    labels = function(x) dollar_format()(10^x - 1),
    guide = guide_colorbar(
      barwidth = 30,          # largura maior da barra
      barheight = 1.5,        # altura maior da barra
      ticks = TRUE,
      ticks.linewidth = 0.7,
      label.position = "bottom",
      title.position = "top",
      title.hjust = 0.5,
      label.theme = element_text(size = 12, angle = 45, hjust = 1) # rotaciona labels
    )
  ) +
  labs(
    title = "üí∞ Reservas Internacionais por Pa√≠s",
    subtitle = "Ano: {closest_state}",
    caption = "Fonte: Banco Mundial ¬∑ Indicador: FI.RES.TOTL.CD"
  ) +
  theme_minimal(base_size = 15) +
  theme(
    plot.title = element_text(face = "bold", size = 22, hjust = 0.5, color = "#222222"),
    plot.subtitle = element_text(size = 16, hjust = 0.5, color = "#555555"),
    plot.caption = element_text(size = 10, hjust = 1, color = "#777777"),
    legend.title = element_text(size = 14, face = "bold", hjust = 0.5),
    legend.text = element_text(size = 12),
    legend.position = "bottom",
    panel.grid = element_blank(),
    axis.text = element_blank(),
    axis.title = element_blank()
  ) +
  transition_states(year, transition_length = 2, state_length = 1, wrap = FALSE) +
  ease_aes("linear")
```

# Conclus√£o
 

A an√°lise emp√≠rica refor√ßa a hip√≥tese de que economias altamente integradas ao mercado externo,
especialmente aquelas com baixa diversifica√ß√£o e reservas cambiais limitadas, tendem a ser mais
vulner√°veis a choques externos.

Por outro lado, exporta√ß√µes podem ser uma fonte de crescimento robusto e resili√™ncia se
acompanhadas de: Diversifica√ß√£o geogr√°fica e setorial das vendas externas, Pol√≠tica cambial flex√≠vel e
reservas suficientes, Institui√ß√µes fiscais e monet√°rias s√≥lidas, Capacidade de est√≠mulo interno e
prote√ß√£o social Modelos baseados na demanda interna oferecem maior autonomia em contextos de crise, mas tamb√©m exigem uma base produtiva diversificada, distribui√ß√£o de renda equilibrada e estabilidade institucional.

Assim, a resposta √† pergunta inicial √©: sim, o crescimento por exporta√ß√µes pode aumentar a vulnerabilidade externa, mas esse efeito depende criticamente do grau de depend√™ncia, da diversifica√ß√£o produtiva e da capacidade de resposta de cada pa√≠s. O equil√≠brio entre orienta√ß√£o externa e fortalecimento do mercado interno √© a chave para uma economia menos exposta e mais resiliente no longo prazo.
